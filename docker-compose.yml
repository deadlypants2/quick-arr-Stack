version: '3.4'
services:
  vpn:
    container_name: vpn
    image: 'dperson/openvpn-client'
    environment:
      - 'OTHER_ARGS= --mute-replay-warnings'
    cap_add:
      - net_admin
      - SYS_MODULE
    restart: unless-stopped
    volumes:
      - '${ROOT}/config/vpn:/vpn'
      - /lib/modules:/lib/modules
    security_opt:
      - 'label:disable'
    devices:
      - '/dev/net/tun:/dev/net/tun'
    ports:
      - '8080:8080' #qbittorrent web UI Port
    command: '-f "" -r 192.168.68.0/24'

  nzbget:
    image: lscr.io/linuxserver/nzbget
    container_name: nzbget
    environment:
      - 'PUID=${PUID}'
      - 'PGID=${PGID}'
      - 'TZ=${TZ}'
    volumes:
      - '${ROOT}/nzbget/data:/config'
      - '${HDDSTORAGE}/usenet:${HDDSTORAGE}/usenet'
    ports:                     
      - 6789:6789              
    restart: unless-stopped
  
  qbittorrent:
    container_name: qbittorrent
    image: lscr.io/linuxserver/qbittorrent
    restart: unless-stopped
    environment:
      - 'PUID=${PUID}'
      - 'PGID=${PGID}'
      - 'TZ=${TZ}'
#      - TORRENTING_PORT=6881
    volumes:
      - '${ROOT}/config/qbittorrent:/config'
      - '${HDDSTORAGE}/torrent:${HDDSTORAGE}/torrent'
#    ports:
#      - 8080:8080              #remove comment if you are not using the VPN
#      - 6881:6881
#      - 6881:6881/udp
    network_mode: 'service:vpn' #comment/remove if you are not using the VPN
    depends_on:                 #comment/remove if you are not using the VPN
      - vpn                     #comment/remove if you are not using the VPN

  prowlarr:
    image: lscr.io/linuxserver/prowlarr
    container_name: prowlarr
    environment:
      - 'PUID=${PUID}'
      - 'PGID=${PGID}'
      - 'TZ=${TZ}'
    volumes:
      - '${ROOT}/config/prowlarr:/config'
    restart: unless-stopped
    ports:
      - '9696:9696' #uncomment if you are not using the VPN


  sonarr:
    container_name: sonarr
    image: 'lscr.io/linuxserver/sonarr'
    restart: unless-stopped
    network_mode: host
    environment:
      - 'PUID=${PUID}'
      - 'PGID=${PGID}'
      - 'TZ=${TZ}'
    volumes:
      - '/etc/localtime:/etc/localtime:ro'
      - '${ROOT}/config/sonarr:/config'
      - '${HDDSTORAGE}:{HDDSTORAGE}'

  radarr:
    container_name: radarr
    image: 'lscr.io/linuxserver/radarr'
    restart: unless-stopped
    network_mode: host
    environment:
      - 'PUID=${PUID}'
      - 'PGID=${PGID}'
      - 'TZ=${TZ}'
    volumes:
      - '/etc/localtime:/etc/localtime:ro'
      - '${ROOT}/config/radarr:/config'
      - '${HDDSTORAGE}:{HDDSTORAGE}'

  lidarr:
    image: lscr.io/linuxserver/lidarr
    container_name: lidarr
    environment:
      - 'PUID=${PUID}'
      - 'PGID=${PGID}'
      - 'TZ=${TZ}'
    volumes:
      - ${ROOT}/config/lidarr:/config'
      - '${HDDSTORAGE}:'
    ports:
      - 8686:8686
    restart: unless-stopped

  bazarr:
    container_name: bazarr
    image: 'lscr.io/linuxserver/bazarr'
    restart: unless-stopped
    #network_mode: host
    environment:
      - 'PUID=${PUID}'
      - 'PGID=${PGID}'
      - 'TZ=${TZ}'
      - UMASK_SET=022
    volumes:
      - '${ROOT}/config/bazarr:/config'
      - '${HDDSTORAGE}:{HDDSTORAGE}'
    ports:
      - '6767:6767'

  jellyseerr:
    image: ghcr.io/fallenbagel/jellyseerr
    init: true
    container_name: jellyseerr
    environment:
      - LOG_LEVEL=debug
      - 'TZ=${TZ}'
      - PORT=5055 #optional
    ports:
      - 5055:5055
    volumes:
      - '${ROOT}/config/jellyseerr/config:/app/config'
    healthcheck:
      test: wget --no-verbose --tries=1 --spider http://localhost:5055/api/v1/status || exit 1
      start_period: 20s
      timeout: 3s
      interval: 15s
      retries: 3
    restart: unless-stopped

listsync-full:
    image: ghcr.io/woahai321/list-sync:main
    container_name: listsync-full
    ports:
      # Frontend (Nuxt 3 Dashboard) 
      - "3222:3222"
      # Backend API (FastAPI)
      - "4222:4222"
    environment:
      # Timezone Configuration (set to Europe/London for BST/GMT, change as needed)
      # Timezone - Supports: IANA names (Europe/Paris), abbreviations (CET), offsets (UTC+1, GMT-5)
      - 'TZ=${TZ}'
      
      # Overseerr Configuration 
      - OVERSEERR_URL=${OVERSEERR_URL:-}
      - OVERSEERR_API_KEY=${OVERSEERR_API_KEY:-}
      - OVERSEERR_USER_ID=${OVERSEERR_USER_ID:-1}
      - SYNC_INTERVAL=${SYNC_INTERVAL:-24}
      - AUTOMATED_MODE=true
      - OVERSEERR_4K=${OVERSEERR_4K:-false}
      
      # List Configuration (comma-separated)
      - IMDB_LISTS=${IMDB_LISTS:-}
      - TRAKT_LISTS=${TRAKT_LISTS:-}
      - LETTERBOXD_LISTS=${LETTERBOXD_LISTS:-}
      - ANILIST_LISTS=${ANILIST_LISTS:-}
      - MDBLIST_LISTS=${MDBLIST_LISTS:-}
      - STEVENLU_LISTS=${STEVENLU_LISTS:-}
      - TRAKT_SPECIAL_LISTS=${TRAKT_SPECIAL_LISTS:-}
      - TRAKT_SPECIAL_ITEMS_LIMIT=${TRAKT_SPECIAL_ITEMS_LIMIT:-}
      
      # Trakt API Configuration
      - TRAKT_CLIENT_ID=${TRAKT_CLIENT_ID:-}

      # Optional Discord webhook
      - DISCORD_WEBHOOK_URL=${DISCORD_WEBHOOK_URL:-}
      
      # Internal API URL for frontend (Nuxt Nitro proxy handles /api internally)
      - NUXT_PUBLIC_API_URL=${NUXT_PUBLIC_API_URL:-http://0.0.0.0:4222}
      
      # Docker-specific settings
      - RUNNING_IN_DOCKER=true
      - NO_SANDBOX=1
      - DISPLAY=:99
    volumes:
      # Persist data directory
      - '${ROOT}/config/listsync:/usr/src/app/data'
      # Mount environment file
      - ./.env:/usr/src/app/.env
      # Optional: Mount logs for debugging
      - '${ROOT}/logs/listsync:/var/log/supervisor
    restart: unless-stopped 
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4222/api/system/health", "&&", "curl", "-f", "http://localhost:3222"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    # Note: Complete ListSync application with:
    # - Core sync service (python -m list_sync)
    # - FastAPI backend (port 4222)
    # - Nuxt 3 frontend (port 3222)
    # All managed by supervisor for reliability 



#Remove comments if needed

#  flaresolverr:
#    # DockerHub mirror flaresolverr/flaresolverr:latest
#    image: ghcr.io/flaresolverr/flaresolverr
#    container_name: flaresolverr
#    environment:
#      - LOG_LEVEL=${LOG_LEVEL:-info}
#      - LOG_FILE=${LOG_FILE:-none}
#      - LOG_HTML=${LOG_HTML:-false}
#      - CAPTCHA_SOLVER=${CAPTCHA_SOLVER:-none}
#      - 'TZ=${TZ}'
#    ports:
#      - "${PORT:-8191}:8191"
#    volumes:
#      - '${ROOT}/config/flaresolver:/config'
#    restart: unless-stopped